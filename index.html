<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì´ì¤€ì˜ íŒ¬ë¯¸íŒ…</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  background:#000;
  font-family:'Segoe UI','Apple SD Gothic Neo',sans-serif;
}
.app{
  width:100vw;
  height:100vh;
  background:#fff;
  overflow:hidden;
  position:relative;
  display:flex;
  flex-direction:column;
}
.header{
  background:#e6002d;
  color:#fff;
  padding:14px;
  text-align:center;
  font-weight:700;
  font-size:17px;
}
.clock-box{
  padding:14px;
  text-align:center;
  border-bottom:1px solid #ddd;
}
.clock{font-size:26px;font-weight:700;}
.status{font-size:13px;color:#666;margin-top:4px;}

.notice{
  padding:16px;
  font-size:13px;
  line-height:1.6;
  color:#444;
}
.notice h3{
  margin-top:0;
  font-size:15px;
}
.notice ul{padding-left:18px;}
.notice li{margin-bottom:6px;}

.reserve-btn{
  width:100%;
  background:#e6002d;
  color:#fff;
  border:none;
  padding:14px;
  font-size:16px;
  border-radius:8px;
  font-weight:700;
  cursor:pointer;
  display:none;
}

.waiting, .captcha, .seat-screen, .payment, .result{
  display:none;
  padding:16px;
  flex:1;
  overflow-y:auto;
  box-sizing:border-box;
}

.wait-title{font-weight:700;margin-bottom:8px;}
.wait-num{font-size:32px;font-weight:800;}
.wait-sub{font-size:13px;color:#555;margin-top:4px;}
.bar-wrap{height:10px;background:#eee;border-radius:5px;overflow:hidden;margin:10px 0;}
.bar{height:100%;width:0%;background:#e6002d;transition:width .15s linear;}
.ready-msg{
  margin-top:10px;
  color:#e6002d;
  font-weight:700;
  display:none;
}

/* CAPTCHA */
.captcha-box{
  margin-top:40px;
  text-align:center;
}
.captcha-code{
  font-size:26px;
  font-weight:800;
  letter-spacing:6px;
  background:#eee;
  padding:10px 14px;
  border-radius:6px;
  display:inline-block;
}
.captcha input{
  margin-top:16px;
  padding:10px;
  width:140px;
  font-size:16px;
  text-align:center;
  letter-spacing:4px;
}
.captcha button{
  margin-top:12px;
  width:100%;
  padding:12px;
  background:#e6002d;
  color:#fff;
  border:none;
  border-radius:6px;
  font-weight:700;
}

/* SEAT */
.seat-screen h3{margin-top:0;}
.stage{
  text-align:center;
  font-size:12px;
  margin-bottom:8px;
  color:#555;
}
.seat-map{
  display:grid;
  grid-template-columns: repeat(20, 1fr);
  gap:3px;
}
.seat{
  width:100%;
  padding-top:100%;
  position:relative;
  background:#4caf50;
  border-radius:4px;
  cursor:pointer;
}
.seat.vip{background:#d32f2f;}
.seat.r{background:#1976d2;}
.seat.s{background:#4caf50;}
.seat.taken{background:#ccc; cursor:not-allowed;}
.seat.selected{outline:3px solid #ff9800;}

.seat::after{
  content:attr(data-id);
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  font-size:7px;
  color:#fff;
}

/* PAYMENT */
.payment h3{margin-top:0;}
.pay-btn{
  width:100%;
  padding:12px;
  margin-top:10px;
  border:none;
  border-radius:6px;
  font-weight:700;
  cursor:pointer;
}
.kakao{background:#fee500;}
.toss{background:#1e88e5;color:#fff;}
.naver{background:#03c75a;color:#fff;}
.bank{background:#555;color:#fff;}

/* RESULT */
.result h3{text-align:center;}
.result p{text-align:center;font-size:14px;}

</style>
</head>
<body>

<div class="app">
  <div class="header">ì´ì¤€ì˜ íŒ¬ë¯¸íŒ…</div>

  <div class="clock-box" id="clockBox">
    <div class="clock" id="clock">06:59:57</div>
    <div class="status" id="status">ì˜ˆë§¤ ì˜¤í”ˆ ëŒ€ê¸° ì¤‘</div>
  </div>

  <!-- NOTICE -->
  <div class="notice" id="noticeArea">
    <h3>ğŸŸï¸ í‹°ì¼“ ì˜ˆë§¤ ì•ˆë‚´</h3>
    <ul>
      <li>ì˜ˆë§¤ëŠ” <b>1ì¸ ìµœëŒ€ 2ë§¤</b>ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
      <li>ë§¤í¬ë¡œ ì‚¬ìš© ì‹œ ìë™ ì·¨ì†Œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li>ì˜ˆë§¤ ì‹œì‘ê³¼ ë™ì‹œì— ëŒ€ê¸°ì—´ì´ ìƒì„±ë©ë‹ˆë‹¤.</li>
      <li>ê²°ì œ ë‹¨ê³„ì—ì„œ <b>ì‹œê°„ ì´ˆê³¼ ì‹œ ìë™ ì·¨ì†Œ</b>ë©ë‹ˆë‹¤.</li>
      <li>ì¢Œì„ ì„ íƒ í›„ ê²°ì œ ì™„ë£Œ ì „ê¹Œì§€ëŠ” ì˜ˆë§¤ê°€ í™•ì •ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
      <li>ì–‘ì˜ˆì„œ ì œì‘ã…‹ã…‹.</li>
    </ul>
  </div>

  <!-- MAIN -->
  <div class="main" id="mainArea" style="padding:16px;">
    <button class="reserve-btn" id="reserveBtn">ì˜ˆë§¤í•˜ê¸°</button>
  </div>

  <!-- WAITING -->
  <div class="waiting" id="waitingArea">
    <div class="wait-title">ëŒ€ê¸°ì—´</div>
    <div>ë‚´ ìˆœë²ˆ</div>
    <div class="wait-num" id="myRank">-</div>
    <div class="bar-wrap"><div class="bar" id="waitBar"></div></div>
    <div class="wait-sub" id="behindNum">ë’¤ì— ëŒ€ê¸°ì: - ëª…</div>
    <div class="wait-sub" id="clickSpeedText"></div>
    <div class="ready-msg" id="readyMsg">ğŸ”¥ ê³§ ì…ì¥í•©ë‹ˆë‹¤! ì¤€ë¹„í•˜ì„¸ìš”!</div>
  </div>

  <!-- CAPTCHA -->
  <div class="captcha" id="captchaArea">
    <div class="captcha-box">
      <div>ë³´ì•ˆë¬¸ìë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>
      <div class="captcha-code" id="captchaCode">ABCDE</div>
      <input type="text" id="captchaInput" placeholder="ABCDE" maxlength="5">
      <button id="captchaBtn">í™•ì¸</button>
      <div id="captchaMsg" style="color:red;font-size:13px;margin-top:8px;"></div>
    </div>
  </div>

  <!-- SEAT -->
  <div class="seat-screen" id="seatArea">
    <h3>ì¢Œì„ ì„ íƒ</h3>
    <div class="stage">ë¬´ëŒ€</div>
    <div class="seat-map" id="seatMap"></div>
    <button class="reserve-btn" id="toPayBtn" style="margin-top:10px;display:none;">ê²°ì œí•˜ê¸°</button>
  </div>

  <!-- PAYMENT -->
  <div class="payment" id="paymentArea">
    <h3>ê²°ì œ ìˆ˜ë‹¨ ì„ íƒ</h3>
    <button class="pay-btn kakao" data-method="ì¹´ì¹´ì˜¤í˜ì´">ì¹´ì¹´ì˜¤í˜ì´</button>
    <button class="pay-btn toss" data-method="í† ìŠ¤">í† ìŠ¤</button>
    <button class="pay-btn naver" data-method="ë„¤ì´ë²„í˜ì´">ë„¤ì´ë²„í˜ì´</button>
    <button class="pay-btn bank" data-method="ë¬´í†µì¥ì…ê¸ˆ">ë¬´í†µì¥ì…ê¸ˆ</button>
  </div>

  <!-- RESULT -->
  <div class="result" id="resultArea">
    <h3 id="resultTitle"></h3>
    <p id="resultMsg"></p>
    <button class="reserve-btn" id="restartBtn" style="display:block;margin-top:20px;">ë‹¤ì‹œí•˜ê¸°</button>
  </div>
</div>

<script>
/* ================= TIME ================= */
let h=6,m=59,s=57;
const clockEl=document.getElementById("clock");
const statusEl=document.getElementById("status");
const reserveBtn=document.getElementById("reserveBtn");
const noticeArea=document.getElementById("noticeArea");

function pad(n){return n<10?"0"+n:n;}

let openMoment=null;

function tick(){
  s++;
  if(s>=60){s=0;m++;}
  if(m>=60){m=0;h++;}
  clockEl.textContent=`${pad(h)}:${pad(m)}:${pad(s)}`;

  if(h===7 && m===0 && s===0){
    statusEl.textContent="ì˜ˆë§¤ ì‹œì‘!";
    reserveBtn.style.display="block";
    noticeArea.style.display="none";
    openMoment=Date.now();
  }
}
setInterval(tick,1000);

/* ================= UI UTILS ================= */
const mainArea=document.getElementById("mainArea");
const waitingArea=document.getElementById("waitingArea");
const captchaArea=document.getElementById("captchaArea");
const seatArea=document.getElementById("seatArea");
const paymentArea=document.getElementById("paymentArea");
const resultArea=document.getElementById("resultArea");

function show(area){
  [mainArea,waitingArea,captchaArea,seatArea,paymentArea,resultArea].forEach(a=>a.style.display="none");
  area.style.display="block";
}

/* ================= WAITING ================= */
const myRankEl=document.getElementById("myRank");
const behindNumEl=document.getElementById("behindNum");
const waitBar=document.getElementById("waitBar");
const clickSpeedText=document.getElementById("clickSpeedText");
const readyMsg=document.getElementById("readyMsg");

let clickDelaySec=0;

reserveBtn.onclick=()=>{
  clickDelaySec=(Date.now()-openMoment)/1000;
  show(waitingArea);

  let rank;
  if(clickDelaySec<0.05) rank=5+Math.floor(Math.random()*10);
  else if(clickDelaySec<0.1) rank=30+Math.floor(Math.random()*50);
  else if(clickDelaySec<0.2) rank=200+Math.floor(Math.random()*300);
  else if(clickDelaySec<0.3) rank=800+Math.floor(Math.random()*1200);
  else if(clickDelaySec<0.4) rank=3000+Math.floor(Math.random()*4000);
  else rank=8000+Math.floor(Math.random()*10000);

  let behind=rank+Math.floor(Math.random()*8000)+2000;

  myRankEl.textContent=rank.toLocaleString();
  behindNumEl.textContent=`ë’¤ì— ëŒ€ê¸°ì: ${behind.toLocaleString()} ëª…`;
  clickSpeedText.textContent=`ì˜ˆë§¤ ì‹œì‘ í›„ ${clickDelaySec.toFixed(2)}ì´ˆ ë’¤ í´ë¦­`;

  const total=rank;

  const interval=setInterval(()=>{
    if(rank<=0){
      clearInterval(interval);
      startCaptcha();
      return;
    }

    let drop;
    if(rank>2000) drop=Math.floor(Math.random()*400)+150;
    else if(rank>500) drop=Math.floor(Math.random()*120)+40;
    else if(rank>100) drop=Math.floor(Math.random()*40)+15;
    else if(rank>20) drop=Math.floor(Math.random()*10)+4;
    else drop=1;

    rank-=drop;
    if(rank<0) rank=0;

    let behindChange=Math.floor(Math.random()*300)-120;
    behind+=behindChange;
    if(behind<0) behind=0;

    myRankEl.textContent=rank.toLocaleString();
    waitBar.style.width=((total-rank)/total*100)+"%";
    behindNumEl.textContent=`ë’¤ì— ëŒ€ê¸°ì: ${behind.toLocaleString()} ëª…`;

    if(rank<=10){
      readyMsg.style.display="block";
    }
  }, rank<=10 ? 700 : 160);
};

/* ================= CAPTCHA ================= */
const captchaCodeEl=document.getElementById("captchaCode");
const captchaInput=document.getElementById("captchaInput");
const captchaBtn=document.getElementById("captchaBtn");
const captchaMsg=document.getElementById("captchaMsg");

function randomCaptcha(){
  const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  let s="";
  for(let i=0;i<5;i++) s+=chars[Math.floor(Math.random()*chars.length)];
  return s;
}

function startCaptcha(){
  captchaInput.value="";
  captchaMsg.textContent="";
  captchaCodeEl.textContent=randomCaptcha();
  show(captchaArea);
}

captchaBtn.onclick=()=>{
  if(captchaInput.value.toUpperCase()!==captchaCodeEl.textContent){
    captchaMsg.textContent="ë³´ì•ˆë¬¸ìê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
    return;
  }
  startSeat();
};

/* ================= SEAT ================= */
const seatMap=document.getElementById("seatMap");
const toPayBtn=document.getElementById("toPayBtn");

let seats=[];
let selectedSeats=[];
let seatSpeedMultiplier=1;

function startSeat(){
  show(seatArea);
  seatMap.innerHTML="";
  seats=[];
  selectedSeats=[];
  toPayBtn.style.display="none";

  const rows=15;
  const cols=20;
  const total=rows*cols;

  // ëŠ¦ê²Œ í´ë¦­í• ìˆ˜ë¡ ì¢Œì„ ì†Œë©¸ ì†ë„ ì¦ê°€
  if(clickDelaySec<0.05) seatSpeedMultiplier=1;
  else if(clickDelaySec<0.1) seatSpeedMultiplier=1.3;
  else if(clickDelaySec<0.2) seatSpeedMultiplier=1.8;
  else if(clickDelaySec<0.3) seatSpeedMultiplier=2.5;
  else if(clickDelaySec<0.4) seatSpeedMultiplier=3.2;
  else seatSpeedMultiplier=4;

  for(let i=0;i<total;i++){
    const seat=document.createElement("div");
    seat.className="seat s";
    seat.dataset.index=i;
    seatMap.appendChild(seat);
    seats.push(seat);
  }

  startSeatDisappear();
}

function startSeatDisappear(){
  const interval=setInterval(()=>{
    const available=seats.filter(s=>!s.classList.contains("taken") && !s.classList.contains("selected"));
    if(available.length===0){
      clearInterval(interval);
      return;
    }

    let base;
    if(available.length>200) base=8;
    else if(available.length>100) base=5;
    else if(available.length>50) base=3;
    else base=1;

    const speed=Math.ceil(base*seatSpeedMultiplier);

    for(let i=0;i<speed;i++){
      if(available.length===0) break;
      const s=available.splice(Math.floor(Math.random()*available.length),1)[0];
      s.classList.add("taken");
    }
  },120);
}

seatMap.onclick=(e)=>{
  const seat=e.target;
  if(!seat.classList.contains("seat") || seat.classList.contains("taken")) return;

  if(seat.classList.contains("selected")){
    seat.classList.remove("selected");
    selectedSeats=selectedSeats.filter(s=>s!==seat);
  }else{
    if(selectedSeats.length>=2) return;
    seat.classList.add("selected");
    selectedSeats.push(seat);
  }

  toPayBtn.style.display=selectedSeats.length>0?"block":"none";
};

toPayBtn.onclick=()=>{
  startPayment();
};

/* ================= PAYMENT ================= */
const paymentButtons=document.querySelectorAll(".pay-btn");

function startPayment(){
  show(paymentArea);
}

paymentButtons.forEach(btn=>{
  btn.onclick=()=>{
    const fail=Math.random()<0.15;
    if(fail){
      alert("âŒ ê²°ì œ ì‹¤íŒ¨! ì¢Œì„ì´ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ì„ ì ë˜ì—ˆìŠµë‹ˆë‹¤.");
      selectedSeats.forEach(s=>s.classList.add("taken"));
      selectedSeats=[];
      startSeat();
    }else{
      showResult(true, btn.dataset.method);
    }
  };
});

/* ================= RESULT ================= */
const resultTitle=document.getElementById("resultTitle");
const resultMsg=document.getElementById("resultMsg");
const restartBtn=document.getElementById("restartBtn");

function showResult(success, method){
  show(resultArea);
  if(success){
    resultTitle.textContent="ì˜ˆë§¤ ì™„ë£Œ!";
    resultMsg.textContent=`${method} ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`;
  }else{
    resultTitle.textContent="âŒ ì˜ˆë§¤ ì‹¤íŒ¨";
    resultMsg.textContent="ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
  }
}

restartBtn.onclick=()=>{
  location.reload();
};
</script>

</body>
</html>
